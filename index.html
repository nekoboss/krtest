<!DOCTYPE html>
<html>
<head>
  <title>開啟相機並拍照</title>
  <style>
    button {
      width: 200px; 
      height: 50px; 
      font-size: 18px; 
      margin: 10px;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>
  <button onclick="openCamera()">開啟相機</button>
  <button id="takePhotoButton" style="display:none;" onclick="takePhoto()">拍照</button>
  <div>
    <video id="video" style="display:none;" autoplay></video>
    <canvas id="canvas"></canvas>
    <img id="photo" style="display:none;">
  </div>

  <script>
    let videoStream;

    function openCamera() {
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }) 
          .then(function (stream) {
            const video = document.getElementById('video');
            video.srcObject = stream;
            video.play();
            video.style.display = 'block';
            document.getElementById('takePhotoButton').style.display = 'inline-block';
            videoStream = stream;
          })
          .catch(function (error) {
            console.error('無法開啟相機', error);
          });
      } else {
        alert('您的瀏覽器不支援相機功能');
      }
    }

    function takePhoto() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const photo = document.getElementById('photo');

      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      const dataURL = canvas.toDataURL('image/png');
      photo.src = dataURL;
      photo.style.display = 'block';
      canvas.style.display = 'none';

      // 停止相機流
      videoStream.getTracks().forEach(track => track.stop());
    }
  </script>
</body>
</html>

